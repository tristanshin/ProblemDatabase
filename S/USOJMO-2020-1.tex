This is just generalized bubble sort.
